<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PAPI SPESE SUMMER 2025</title>

  <!-- CSS di Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    /* colori generali */
    body {
      background-color: #111;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
    }
    h1, h2, h3, h4, h5, h6,
    label, .form-label,
    .btn, .archive-item, .card-title, .card-text {
      color: #fff !important;
    }
    a { color: #ffe066; }

    /* placeholder più chiaro */
    ::placeholder {
      color: #ccc !important;
      opacity: 1;
    }

    /* carta e pulsanti */
    .card {
      background-color: #1e1e1e;
      border: none;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 0 12px rgba(255,255,255,0.05);
    }
    .btn-primary {
      background-color: #4285f4;
      border: none;
    }
    .btn-primary:hover {
      background-color: #3367d6;
    }
    .btn-success {
      background-color: #34a853;
      border: none;
    }
    .btn-danger {
      background-color: #ea4335;
      border: none;
    }
    .btn-secondary {
      background-color: #6c757d;
      border: none;
    }

    /* pie chart trasparente */
    #pieChart {
      background: transparent !important;
    }

    /* elenco archivio */
    #archiveList li {
      margin-bottom: .5rem;
    }
  </style>
</head>
<body>

<div class="container py-5">
  <h1 class="text-center mb-4">PAPI SPESE <span class="text-warning">SUMMER 2025</span></h1>

  <div class="row">
    <!-- FORM + DETTAGLIO -->
    <div class="col-md-6 mb-4">
      <div class="card">
        <h4>Spese Serata</h4>
        <div class="mb-3">
          <label class="form-label">Giorno</label>
          <select id="giorno" class="form-select">
            <option>Venerdì</option>
            <option>Sabato</option>
            <option>Serata Extra</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Descrizione Serata</label>
          <input id="descrizione" class="form-control" placeholder="Es: Opening, DJ Guest, ecc." />
        </div>
        <div class="mb-3">
          <label class="form-label">Data</label>
          <input id="data" type="date" class="form-control" value="2025-04-30" />
        </div>

        <hr class="border-secondary">

        <h5>Dettaglio Spese</h5>
        <div class="mb-3">
          <label class="form-label">Voce di spesa</label>
          <input id="voce" class="form-control" placeholder="Es: DJ, PR..." />
        </div>
        <div class="mb-3">
          <label class="form-label">Importo</label>
          <input id="importo" type="number" class="form-control" placeholder="0" />
        </div>
        <button id="addSpesa" class="btn btn-primary w-100 mb-3">Aggiungi Spesa</button>

        <ul id="listaSpese" class="list-unstyled ps-3"></ul>

        <div class="mb-3">
          <label class="form-label">POS</label>
          <input id="pos" type="number" class="form-control" value="0" />
        </div>
        <div class="mb-3">
          <label class="form-label">Contante</label>
          <input id="contante" type="number" class="form-control" value="0" />
        </div>
        <h5 id="totaleIncasso">Totale Incasso: €0.00</h5>
        <button id="saveArchive" class="btn btn-success w-100">Salva e Archivia Serata</button>
      </div>
    </div>

    <!-- CHART -->
    <div class="col-md-6">
      <div class="card h-100">
        <h4>Composizione Incasso</h4>
        <canvas id="pieChart"></canvas>
        <button id="exportAll" class="btn btn-secondary mt-3 w-100">Esporta Tutte in PDF</button>
      </div>
    </div>
  </div>

  <!-- ARCHIVIO -->
  <div class="mt-5">
    <h3>Archivio Serate</h3>
    <ul id="archiveList" class="list-unstyled ps-3"></ul>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // DOM elements
  const giornoInput = document.getElementById('giorno');
  const descInput   = document.getElementById('descrizione');
  const dataInput   = document.getElementById('data');
  const voceInput   = document.getElementById('voce');
  const importoInput= document.getElementById('importo');
  const posInput    = document.getElementById('pos');
  const contanteInput = document.getElementById('contante');
  const listaSpeseEl = document.getElementById('listaSpese');
  const totaleEl     = document.getElementById('totaleIncasso');
  const archiveListEl= document.getElementById('archiveList');

  let spese = [];
  let chart;

  // inizializza Chart.js
  function initChart() {
    const ctx = document.getElementById('pieChart');
    chart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['POS','Contante','Spese'],
        datasets: [{
          data: [0,0,0],
          backgroundColor: ['#4DB6AC','#64B5F6','#EF5350']
        }]
      },
      options: {
        plugins: { legend: { labels:{ color:'#fff' } } }
      }
    });
  }

  // aggiorna lista spese e ricalcola
  function updateSpese() {
    listaSpeseEl.innerHTML = '';
    spese.forEach(s=> {
      const li = document.createElement('li');
      li.textContent = `${s.voce}: €${s.importo.toFixed(2)}`;
      listaSpeseEl.appendChild(li);
    });
    updateChartAndTotale();
  }

  // aggiorna grafico e totale
  function updateChartAndTotale() {
    const pos = parseFloat(posInput.value)||0;
    const cont = parseFloat(contanteInput.value)||0;
    const spesaTot = spese.reduce((sum,s)=>sum+s.importo,0);
    const incasso = pos + cont - spesaTot;
    totaleEl.textContent = `Totale Incasso: €${incasso.toFixed(2)}`;

    chart.data.datasets[0].data = [pos,cont,spesaTot];
    chart.update();
  }

  // aggiungi spesa
  document.getElementById('addSpesa').addEventListener('click',()=>{
    const v = voceInput.value.trim();
    const imp = parseFloat(importoInput.value)||0;
    if(!v||imp<=0) return alert('Inserisci voce e importo validi');
    spese.push({voce:v,importo:imp});
    voceInput.value = '';
    importoInput.value = '';
    updateSpese();
  });

  // listener su pos e contante
  [posInput, contanteInput].forEach(inp=>{
    inp.addEventListener('input', updateChartAndTotale);
  });

  // salva+archivia
  document.getElementById('saveArchive').addEventListener('click',()=>{
    const serata = {
      giorno: giornoInput.value,
      descrizione: descInput.value.trim(),
      data: dataInput.value,
      spese: [...spese],
      pos: parseFloat(posInput.value)||0,
      contante: parseFloat(contanteInput.value)||0,
      incasso: parseFloat(totaleEl.textContent.match(/€([\d\.]+)/)[1])
    };
    // salva nel localStorage
    const archivio = JSON.parse(localStorage.getItem('archivio'))||[];
    archivio.push(serata);
    localStorage.setItem('archivio', JSON.stringify(archivio));
    alert('Serata archiviata!');
    renderArchivio();
  });

  // mostra archivio
  function renderArchivio(){
    archiveListEl.innerHTML = '';
    const archivio = JSON.parse(localStorage.getItem('archivio'))||[];
    archivio.forEach((s,i)=>{
      const li = document.createElement('li');
      li.classList.add('archive-item','mb-3');
      li.innerHTML = `
        <strong>${s.data} – ${s.descrizione}</strong><br>
        Spese: ${s.spese.map(x=>`${x.voce} €${x.importo.toFixed(2)}`).join(', ')}<br>
        POS: €${s.pos.toFixed(2)}, Contante: €${s.contante.toFixed(2)}, 
        <span class="fw-bold">Incasso: €${s.incasso.toFixed(2)}</span>
      `;
      archiveListEl.appendChild(li);
    });
  }

  // esporta tutto in PDF (usa la stampa browser)
  document.getElementById('exportAll').addEventListener('click',()=>{
    window.print();
  });

  // init
  initChart();
  renderArchivio();
</script>
</body>
</html>
