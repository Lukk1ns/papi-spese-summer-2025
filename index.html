<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>PAPI SPESE SUMMER 2025</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <style>
    /* ---------- BASE ---------- */
    * { box-sizing: border-box; }
    body {
      margin:0; padding:0;
      background:#111; color:#fff;
      font-family:'Segoe UI',sans-serif;
    }
    h1, h2 { margin:0 0 1rem; }
    .container { max-width:1024px; margin:2rem auto; padding:0 1rem; }
    .title { text-align:center; font-size:2rem; }
    .highlight { color:#ffe066; }
    /* ---------- LAYOUT ---------- */
    .main { display:flex; flex-wrap:wrap; gap:1rem; }
    .form-panel, .chart-panel { background:#1e1e1e; padding:1rem; border-radius:.5rem; }
    .form-panel { flex:1 1 320px; }
    .chart-panel { flex:1 1 320px; position:relative; }
    label { display:block; margin-bottom:.75rem; font-size:.9rem; }
    input, select { width:100%; padding:.5rem; margin-top:.25rem; background:#222; border:1px solid #444; color:#fff; border-radius:.25rem; }
    ul { list-style:none; padding:0; margin:0; }
    ul#lista-spese li { margin: .25rem 0; }
    .totale { margin:1rem 0; font-weight:bold; }
    .archive { margin-top:2rem; }
    .archive ul { list-style:none; padding:0; }
    .archive li {
      background:#1a1a1a; padding:.75rem; margin-bottom:.5rem;
      border-radius:.25rem; position:relative;
    }
    /* ---------- BOTTONI ---------- */
    .btn {
      display:inline-block; padding:.75rem 1rem; border:none;
      border-radius:.25rem; cursor:pointer; color:#fff;
      font-size:1rem; margin-right:.5rem;
    }
    .btn.blue  { background:#4479ff; }
    .btn.green { background:#5baa46; }
    .btn.red   { background:#c34d4d; }
    .btn-sm {
      padding:.25rem .5rem; font-size:.8rem; margin-left:.5rem;
    }
    .actions { margin-top:1rem; text-align:center; }
    /* ---------- CHART ---------- */
    canvas { width:100% !important; height:auto !important; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">PAPI SPESE <span class="highlight">SUMMER 2025</span></h1>

    <div class="main">
      <!-- FORM & LISTA SPESE -->
      <div class="form-panel">
        <label>Giorno
          <select id="giorno">
            <option>Venerdì</option>
            <option>Sabato</option>
            <option>Extra</option>
          </select>
        </label>
        <label>Descrizione Serata
          <input id="descrizione" placeholder="Es: Opening, DJ Guest…" />
        </label>
        <label>Data
          <input id="data" type="date" value="2025-04-30" />
        </label>
        <div id="spese-section">
          <label>Voce di spesa
            <input id="voce" placeholder="Es: DJ, PR…" />
          </label>
          <label>Importo
            <input id="importo" type="number" min="0" value="0" />
          </label>
          <button id="add-spesa" class="btn blue">Aggiungi Spesa</button>
          <ul id="lista-spese"></ul>
        </div>
        <label>POS
          <input id="pos" type="number" min="0" value="0" />
        </label>
        <label>Contante
          <input id="contante" type="number" min="0" value="0" />
        </label>
        <div class="totale">Totale Incasso: <span id="tot-incasso">0.00</span> €</div>
        <button id="archivia" class="btn green">Salva e Archivia Serata</button>
        <button id="clear" class="btn red">Svuota Serata</button>
      </div>

      <!-- GRAFICO -->
      <div class="chart-panel">
        <canvas id="pieChart"></canvas>
        <div class="actions">
          <button id="export-all" class="btn blue">Esporta Tutte in PDF</button>
        </div>
      </div>
    </div>

    <!-- ARCHIVIO -->
    <div class="archive">
      <h2>Archivio Serate</h2>
      <ul id="archive-list"></ul>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // REFERENZE
    const giornoEl = document.getElementById('giorno'),
          descEl   = document.getElementById('descrizione'),
          dataEl   = document.getElementById('data'),
          voceEl   = document.getElementById('voce'),
          impEl    = document.getElementById('importo'),
          addSpesa = document.getElementById('add-spesa'),
          listaSp  = document.getElementById('lista-spese'),
          posEl    = document.getElementById('pos'),
          contEl   = document.getElementById('contante'),
          totIncEl = document.getElementById('tot-incasso'),
          archEl   = document.getElementById('archivia'),
          clearEl  = document.getElementById('clear'),
          arcList  = document.getElementById('archive-list'),
          exportAll= document.getElementById('export-all');

    let spese = [];

    // CHART.JS
    const ctx = document.getElementById('pieChart').getContext('2d');
    const pie = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['POS','Contante','Spese'],
        datasets: [{
          data: [0,0,0],
          backgroundColor: ['#66c2a5','#4479ff','#ff6f61']
        }]
      },
      options: {
        plugins: {
          legend: { labels: { color:'#fff' } }
        }
      }
    });

    // AGGIORNA GRAFICO E TOTALE
    function aggiornaGrafico() {
      const pos   = +posEl.value,
            cas   = +contEl.value,
            totSp = spese.reduce((s,e)=>s+e.importo,0),
            net   = pos + cas - totSp;
      totIncEl.textContent = net.toFixed(2);
      pie.data.datasets[0].data = [pos, cas, totSp];
      pie.update();
    }

    // AGGIUNGI SPESA
    addSpesa.onclick = ()=>{
      const label = voceEl.value.trim(),
            val   = +impEl.value;
      if(!label || val<=0) return;
      spese.push({label,importo:val});
      const li = document.createElement('li');
      li.textContent = `${label}: €${val.toFixed(2)}`;
      listaSp.append(li);
      voceEl.value = ''; impEl.value = 0;
      aggiornaGrafico();
    };

    // SVUOTA FORM
    clearEl.onclick = ()=>{
      spese = [];
      listaSp.innerHTML = '';
      posEl.value = contEl.value = 0;
      aggiornaGrafico();
    };

    // ARCHIVIA SERATA
    archEl.onclick = ()=>{
      const data  = dataEl.value,
            desc  = descEl.value.trim(),
            pos   = +posEl.value,
            cas   = +contEl.value,
            totSp = spese.reduce((s,e)=>s+e.importo,0),
            net   = (pos + cas - totSp).toFixed(2);

      // CREA VOCE DELL'ARCHIVIO
      const item = document.createElement('li');
      item.innerHTML = `
        <strong>${data} – ${desc}</strong><br>
        Spese: ${spese.map(s=>`${s.label} €${s.importo.toFixed(2)}`).join(', ')}<br>
        POS: €${pos.toFixed(2)}, Contante: €${cas.toFixed(2)}, <em>Incasso: €${net}</em>
        <button class="btn red btn-sm">✕</button>
        <button class="btn blue btn-sm">⎘</button>
      `;
      // ELIMINA
      item.querySelector('.btn-sm.red').onclick = ()=>item.remove();
      // ESPORTA QUELLA SERATA
      item.querySelector('.btn-sm.blue').onclick = ()=>{
        const old = document.title;
        document.title = `${data}-${desc}.pdf`;
        window.print();
        document.title = old;
      };
      arcList.append(item);

      alert('Serata salvata!');
      clearEl.click();
    };

    // ESPORTA TUTTE
    exportAll.onclick = ()=>window.print();

    // AVVIO
    aggiornaGrafico();
  </script>
</body>
</html>
